#!/bin/bash


# Get the new database host from the first parameter
database=$1
# echo $database

# TODO: switch dir of conf
nginxpath=nginx.conf # For testing
# nginxpath=/etc/nginx/nginx.conf

# o for only matching strings, E for regex
res=$(grep -oE "server ${database}:" $nginxpath)
echo $res

# This works on the command line, but not in the script????????????????????????????????????
# TODO: ????????????????????????????????????????????????????????????????????????????????????
echo $(grep -oE "server ${database}:" $nginxpath)

# https://stackoverflow.com/questions/11287861/how-to-check-if-a-file-contains-a-specific-string-using-bash
# if grep -oE "server ${database}:" $nginxpath; then
#   echo 'hello there'
# fi

# Resources:    
# https://www.gnu.org/software/sed/manual/html_node/Regular-Expressions.html
# http://www.grymoire.com/Unix/Sed.html#uh-19

# match any string between server and :, replace it with the new database
# -r for regex
# sed -ri "s|server .+:|server $database:|" $nginxpath



# Reload after swapping database
# /usr/sbin/nginx -s reload